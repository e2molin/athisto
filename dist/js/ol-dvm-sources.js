var rasterMTN_lyr,primeraEdiMTN50_lyr,primeraEdiMTN25_lyr,catastronesMTN50_lyr,actualPNOA_lyr,baseIGN_lyr,siose_lyr,mdtign_lyr,geologicoMinero_lyr,basicOSM_lyr,basicOSM2_lyr,waterColorOSM_lyr,blackWhiteOSM_lyr,footprints_lyr,baseLayerList=new Array,capasBaseMain=new Array,capasBaseMirror=new Array,capasBaseOSMLista=new Array,overlayPNOARasterList=new Array,overlayIGNRasterList=new Array,overlayVectorList=new Array;function loadPNOAFootsprints(){new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.0)"}),stroke:new ol.style.Stroke({color:"rgba(255, 255, 255, 0.0)",width:1}),text:new ol.style.Text({font:"12px Calibri,sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:3})})})}function configCursorMapa(){var LiconFeature=new ol.Feature,LiconStyle=new ol.style.Style({image:new ol.style.Icon({anchor:[10,10],anchorXUnits:"pixels",anchorYUnits:"pixels",src:"img/cross-orange.png"})});LiconFeature.setStyle(LiconStyle);var LvectorSource=new ol.source.Vector({features:[LiconFeature]}),LvectorLayerMouseCross=new ol.layer.Vector({source:LvectorSource,title:"vectorMouseCrossL"});objMap.getLayers().insertAt(1e3,LvectorLayerMouseCross),objMap.on("pointermove",function(event){RiconFeature.setGeometry(null);var coord3857=event.coordinate;RiconFeature.setGeometry(new ol.geom.Point(coord3857))});var RiconFeature=new ol.Feature,RiconStyle=new ol.style.Style({image:new ol.style.Icon({anchor:[10,10],anchorXUnits:"pixels",anchorYUnits:"pixels",src:"img/cross-blue.png"})});RiconFeature.setStyle(RiconStyle);var RvectorSource=new ol.source.Vector({features:[RiconFeature]}),RvectorLayerMouseCross=new ol.layer.Vector({source:RvectorSource,title:"vectorMouseCrossR"});objMapMirror.getLayers().getLength();objMapMirror.getLayers().insertAt(1e3,RvectorLayerMouseCross),objMapMirror.on("pointermove",function(event){LiconFeature.setGeometry(null);var coord3857=event.coordinate;LiconFeature.setGeometry(new ol.geom.Point(coord3857))}),$("#mapLienzo").on("mouseenter",function(event){LiconFeature.setGeometry(null),RiconFeature.setGeometry(null)}),$("#mapMirrorLienzo").on("mouseenter",function(event){LiconFeature.setGeometry(null),RiconFeature.setGeometry(null)})}function loadBasicOSM(visibilityDefault){(waterColorOSM_lyr=new ol.layer.Tile({title:"OSM Acuarela",type:"base",visible:visibilityDefault,source:new ol.source.Stamen({layer:"watercolor"})})).set("keyname","osmacuarela"),waterColorOSM_lyr.set("alias","OSM Acuarela"),capasBaseOSMLista.push(waterColorOSM_lyr),(blackWhiteOSM_lyr=new ol.layer.Tile({title:"OSM Toner",type:"base",visible:visibilityDefault,source:new ol.source.Stamen({layer:"toner"})})).set("keyname","osmatoner"),blackWhiteOSM_lyr.set("alias","OSM Tóner"),capasBaseOSMLista.push(blackWhiteOSM_lyr),(basicOSM_lyr=new ol.layer.Tile({title:"OSM Básico",type:"base",visible:visibilityDefault,source:new ol.source.OSM})).set("keyname","osmbasic"),basicOSM_lyr.set("alias","OSM Básico"),(basicOSM2_lyr=new ol.layer.Tile({title:"OSM Básico 2",type:"base",visible:visibilityDefault,source:new ol.source.OSM})).set("keyname","osmbasic2"),basicOSM2_lyr.set("alias","OSM Básico 2"),capasBaseOSMLista.push(basicOSM2_lyr)}function loadBasicIGN(visibilityDefault){for(var projectionExtent=projection.getExtent(),size=ol.extent.getWidth(projectionExtent)/256,resolutions=new Array(18),matrixIds=new Array(18),z=0;z<18;++z)resolutions[z]=size/Math.pow(2,z),matrixIds[z]=z;var attributionPNOA=new ol.Attribution({html:'PNOA - &copy; <a href="http://www.ign.es" target="_blank">Instituto Geográfico Nacional</a>'}),attributionIGNBase=new ol.Attribution({html:'IGN Base - &copy; <a href="http://www.ign.es" target="_blank">Instituto Geográfico Nacional</a>'}),attributionrasterMTN=new ol.Attribution({html:'Cartografí­a raster - &copy; <a href="http://www.ign.es"  target="_blank">Instituto Geográfico Nacional</a>'}),attributionprimeraEdiMTN50=new ol.Attribution({html:'Primera edición del MTN50 - &copy; <a href="http://www.ign.es"  target="_blank">Instituto Geográfico Nacional</a>'}),attributionprimeraEdiMTN25=new ol.Attribution({html:'Primera edición del MTN25 - &copy; <a href="http://www.ign.es"  target="_blank">Instituto Geográfico Nacional</a>'}),attributioncatastronesMTN50=new ol.Attribution({html:'Minutas MTN50 - &copy; <a href="http://www.ign.es"  target="_blank">Instituto Geográfico Nacional</a>'}),attributiongenericaIGN=new ol.Attribution({html:'&copy; <a href="http://www.ign.es"  target="_blank">Instituto Geográfico Nacional</a>'}),attributionGeologico=new ol.Attribution({html:'&copy; <a href="http://www.igme.es/"  target="_blank">Instituto Geológico y Minero</a>'});(baseIGN_lyr=new ol.layer.Tile({title:"IGN Base",visible:visibilityDefault,extent:projectionExtent,opacity:1,source:new ol.source.WMTS({attributions:[attributionIGNBase],url:"http://www.ign.es/wmts/ign-base",layer:"IGNBaseTodo",matrixSet:"EPSG:3857",format:"image/jpeg",projection:projection,tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(projectionExtent),resolutions:resolutions,matrixIds:matrixIds}),style:"default"})})).set("keyname","baseIGN"),baseIGN_lyr.set("alias","Mapa"),(actualPNOA_lyr=new ol.layer.Tile({title:"PNOA",visible:visibilityDefault,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributionPNOA],url:"http://www.ign.es/wmts/pnoa-ma?request=getTile&layer=OI.OrthoimageCoverage&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg"})})).set("keyname","actualPNOA"),actualPNOA_lyr.set("alias","Imagen"),(rasterMTN_lyr=new ol.layer.Tile({title:"Cartografí­a raster",visible:visibilityDefault,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributionrasterMTN],url:"http://www.ign.es/wmts/mapa-raster?request=getTile&layer=MTN&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg"})})).set("keyname","rasterMTN"),rasterMTN_lyr.set("alias","MTN"),(primeraEdiMTN50_lyr=new ol.layer.Tile({title:"Serie MTN Primera EdiciÃ³n base",visible:visibilityDefault,opacity:1,source:new ol.source.XYZ({url:"http://www.ign.es/wmts/primera-edicion-mtn?request=getTile&layer=mtn50-edicion1&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg",attributions:[attributionprimeraEdiMTN50]})})).set("alias","1ªMTN50"),primeraEdiMTN50_lyr.set("keyname","primeraEdiMTN50"),(primeraEdiMTN25_lyr=new ol.layer.Tile({title:"Serie MTN25 Primera Edición base",visible:visibilityDefault,opacity:1,source:new ol.source.XYZ({url:"http://www.ign.es/wmts/primera-edicion-mtn?request=getTile&layer=mtn25-edicion1&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg",attributions:[attributionprimeraEdiMTN25]})})).set("alias","1ªMTN25"),primeraEdiMTN25_lyr.set("keyname","primeraEdiMTN25"),(catastronesMTN50_lyr=new ol.layer.Tile({title:"Serie minutas MTN50 base",visible:visibilityDefault,opacity:1,source:new ol.source.XYZ({url:"http://www.ign.es/wmts/primera-edicion-mtn?request=getTile&layer=catastrones&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg",attributions:[attributioncatastronesMTN50]})})).set("alias","MinMTN50"),catastronesMTN50_lyr.set("keyname","MinMTN50"),(mdtign_lyr=new ol.layer.Tile({title:"MDT",visible:visibilityDefault,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributiongenericaIGN],url:"http://www.ign.es/wmts/mdt?request=getTile&layer=Relieve&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg"})})).set("keyname","mdtign"),mdtign_lyr.set("alias","MDT"),(siose_lyr=new ol.layer.Tile({title:"Usos del suelo",visible:visibilityDefault,source:new ol.source.TileWMS({url:"http://www.ign.es/wms-inspire/ocupacion-suelo",attributions:[attributiongenericaIGN],params:{LAYERS:"LU.ExistingLandUse",TILED:"true"}})})).set("keyname","siose"),siose_lyr.set("alias","SIOSE"),(geologicoMinero_lyr=new ol.layer.Tile({title:"Geológico",visible:visibilityDefault,source:new ol.source.TileWMS({url:"http://mapas.igme.es/gis/services/Cartografia_Geologica/IGME_Geologico_1M/MapServer/WMSServer",attributions:[attributionGeologico],params:{LAYERS:"3,2,1,0",TILED:"true",FORMAT:"image/png"}})})).set("keyname","geologico"),geologicoMinero_lyr.set("alias","IGM50")}function cargaCapasBaseMain(){for(var projectionExtent=projection.getExtent(),size=ol.extent.getWidth(projectionExtent)/256,resolutions=new Array(18),matrixIds=new Array(18),z=0;z<18;++z)resolutions[z]=size/Math.pow(2,z),matrixIds[z]=z;var attributionIGNBase=new ol.Attribution({html:'IGN Base - &copy; <a href="http://www.ign.es" target="_blank">Instituto Geográfico Nacional</a>'}),attributionPNOA=new ol.Attribution({html:'PNOA - &copy; <a href="http://www.ign.es" target="_blank">Instituto Geográfico Nacional</a>'});baseIGN_Mainlyr=new ol.layer.Tile({title:"IGN Base - Main",visible:!0,extent:projectionExtent,opacity:1,source:new ol.source.WMTS({attributions:[attributionIGNBase],url:"http://www.ign.es/wmts/ign-base",layer:"IGNBaseTodo",matrixSet:"EPSG:3857",format:"image/jpeg",projection:projection,tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(projectionExtent),resolutions:resolutions,matrixIds:matrixIds}),style:"default"})}),baseIGN_Mainlyr.set("keyname","baseIGNMain"),baseIGN_Mainlyr.set("alias","Mapa"),baseIGN_Mainlyr.set("group","imaginery-base"),capasBaseMain.push(baseIGN_Mainlyr),pnoaIGN_Mainlyr=new ol.layer.Tile({title:"PNOA Actual - Main",visible:!1,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributionPNOA],url:"http://www.ign.es/wmts/pnoa-ma?request=getTile&layer=OI.OrthoimageCoverage&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg"})}),pnoaIGN_Mainlyr.set("keyname","pnoaActualIGNMain"),pnoaIGN_Mainlyr.set("alias","Imagen"),pnoaIGN_Mainlyr.set("group","imaginery-base"),capasBaseMain.push(pnoaIGN_Mainlyr),baseIGNTrans_Mainlyr=new ol.layer.Tile({title:"IGN Base Orto - Main",visible:!1,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributionIGNBase],url:"http://www.ign.es/wmts/ign-base?request=getTile&layer=IGNBaseOrto&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/png"})}),baseIGNTrans_Mainlyr.set("keyname","baseIGNTransMain"),baseIGNTrans_Mainlyr.set("alias","Mapa Textos"),baseIGNTrans_Mainlyr.set("group","imaginery-base"),capasBaseMain.push(baseIGNTrans_Mainlyr)}function cargaCapasBaseMirror(){for(var projectionExtent=projection.getExtent(),size=ol.extent.getWidth(projectionExtent)/256,resolutions=new Array(18),matrixIds=new Array(18),z=0;z<18;++z)resolutions[z]=size/Math.pow(2,z),matrixIds[z]=z;var attributionIGNBase=new ol.Attribution({html:'IGN Base - &copy; <a href="http://www.ign.es" target="_blank">Instituto Geográfico Nacional</a>'}),attributionPNOA=new ol.Attribution({html:'PNOA - &copy; <a href="http://www.ign.es" target="_blank">Instituto Geográfico Nacional</a>'});baseIGN_Mirrorlyr=new ol.layer.Tile({title:"IGN Base - Mirror",visible:!0,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributionIGNBase],url:"http://www.ign.es/wmts/ign-base?request=getTile&layer=IGNBaseTodo&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg"})}),baseIGN_Mirrorlyr.set("keyname","baseIGNMirror"),baseIGN_Mirrorlyr.set("alias","Mapa"),baseIGN_Mirrorlyr.set("group","imaginery-base"),capasBaseMirror.push(baseIGN_Mirrorlyr),pnoaIGN_Mirrorlyr=new ol.layer.Tile({title:"PNOA Actual - Mirror",visible:!1,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributionPNOA],url:"http://www.ign.es/wmts/pnoa-ma?request=getTile&layer=OI.OrthoimageCoverage&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/jpeg"})}),pnoaIGN_Mirrorlyr.set("keyname","pnoaActualIGNMirror"),pnoaIGN_Mirrorlyr.set("alias","Imagen"),pnoaIGN_Mirrorlyr.set("group","imaginery-base"),capasBaseMirror.push(pnoaIGN_Mirrorlyr),baseIGNTrans_Mirrorlyr=new ol.layer.Tile({title:"IGN Base Orto - Mirror",visible:!1,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributionIGNBase],url:"http://www.ign.es/wmts/ign-base?request=getTile&layer=IGNBaseOrto&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format=image/png"})}),baseIGNTrans_Mirrorlyr.set("keyname","baseIGNTransMirror"),baseIGNTrans_Mirrorlyr.set("alias","Mapa Textos"),baseIGNTrans_Mirrorlyr.set("group","imaginery-base"),capasBaseMirror.push(baseIGNTrans_Mirrorlyr)}function rasterPNOAOverlays(visibilityDefault){for(var projectionExtent=projection.getExtent(),size=ol.extent.getWidth(projectionExtent)/256,resolutions=new Array(19),matrixIds=new Array(19),z=0;z<19;++z)resolutions[z]=size/Math.pow(2,z),matrixIds[z]=z;$.getJSON("overlays-pnoa.json",{get_param:"value"},function(data){var htmlList=[],ctrlNames=[];htmlList.push('<div class="panel panel-info" style="margin:0px;">'),htmlList.push("<div class='panel-heading panel-heading-sm'><a id='btn-content-panel-AirPhotoLayers' href='#content-panel-AirPhotoLayers' data-toggle='collapse' class='collapsed'><i class='fa fa-plus-square' aria-hidden='true'></i> Vuelos históricos</a></div>"),htmlList.push('<div id=\'content-panel-AirPhotoLayers\' class="panel-body collapse " style="margin:5px; padding:0px;">'),$.each(data,function(index,element){"WMS"==element.tiposerv?rasterOverlay_lyr=new ol.layer.Tile({title:element.title,visible:visibilityDefault,source:new ol.source.TileWMS({attributions:[new ol.Attribution({html:'PNOA - Vuelo Histórico - &copy; <a href="http://www.ign.es" target="_blank">IGN</a>'})],url:element.urlsource,params:{LAYERS:element.layernames,TILED:"true"}})}):"WMTS"==element.tiposerv&&(rasterOverlay_lyr=new ol.layer.Tile({title:element.title,visible:visibilityDefault,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[new ol.Attribution({html:'PNOA - Vuelo Histórico - &copy; <a href="http://www.ign.es" target="_blank">IGN</a>'})],url:element.urlsource+"?request=getTile&layer="+element.layernames+"&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format="+element.imgformat})})),rasterOverlay_lyr.set("nombre",element.nombre),rasterOverlay_lyr.set("group",element.group),rasterOverlay_lyr.set("queryable",element.queryable),rasterOverlay_lyr.set("keyname",element.layerkey),rasterOverlay_lyr.set("alias",element.alias),rasterOverlay_lyr.set("year",element.year),overlayPNOARasterList.push(rasterOverlay_lyr),objMap.addLayer(rasterOverlay_lyr),htmlList.push('<div class="col-md-6 col-sm-6 col-xs-6" style="margin-top:15px;"><input class="toolboxOverlayRaster" data-onstyle="success" data-toggle="toggle" data-on="<img src=\'img/eye16.png\'/> <small>'+element.title+'</small>" data-off="'+element.title+'" type="checkbox" data-width="160" data-size="mini" id="sidebarBtn'+element.layerkey+'"><div class="opacityLyrClass" id="opacityLyrElem'+element.layerkey+'"><div class="ui-slider-handle"><span style="display:none;" class="ui-slider-tooltip"></span></div></div></div>'),ctrlNames.push(element.layerkey)}),htmlList.push("</div></div>"),document.getElementById("panel-AirPhotoLayers").innerHTML=htmlList.join(""),$("#content-panel-AirPhotoLayers").on("hide.bs.collapse",function(){$("#btn-content-panel-AirPhotoLayers").html("<i class='fa fa-plus-square' aria-hidden='true'></i> Vuelos históricos</a></div>")}),$("#content-panel-AirPhotoLayers").on("show.bs.collapse",function(){$("#btn-content-panel-AirPhotoLayers").html("<i class='fa fa-minus-square' aria-hidden='true'></i> Vuelos históricos</a></div>")});for(var i=0,len=ctrlNames.length;i<len;i++)$("#sidebarBtn"+ctrlNames[i]).bootstrapToggle();$(".toolboxOverlayRaster").change(function(){var id=$(this).prop("id"),value_id=$(this).prop("checked"),nomLayer=replaceAll(id,"sidebarBtn","");setLayerVisibleByKey(objMap,nomLayer,value_id),$("#opacityLyrElem"+nomLayer).slider("option","value",100*value_id);var capasActive=new Array;objMap.getLayers().forEach(function(layer,iLayer,layers){"imaginery-flight"!=layer.getProperties().group&&"imaginery-IGN"!=layer.getProperties().group||1!=layer.getProperties().visible||capasActive.push(layer.getProperties().keyname)}),listaCapas=capasActive.join(",")}),$(".opacityLyrClass").slider({min:0,max:100,orientation:"horizontal",range:"min",value:100,slide:function(event,ui){var id=$(this).prop("id"),nomLayer=replaceAll(id,"opacityLyrElem","");$(this).find(".ui-slider-tooltip").text(ui.value),manageVisibleOverlaysByKeyname(objMap,nomLayer,"opacity",ui.value)},change:function(event,ui){},start:function(event,ui){$(this).find(".ui-slider-tooltip").fadeIn("fast")},stop:function(event,ui){$(this).find(".ui-slider-tooltip").fadeOut("fast")},create:function(event,ui){$(this).slider("value")}}),0<browserIE&&browserIE<14?$("#launchUserWMSSelectorInSidebar").hide():initWMSUserComponent(objMap),vectorOverLays(!1),0==mobileMode&&configCursorMapa(),processHash()})}function getPropertyValueFromPNOAOverlaysByYear(nameProperty,year){for(var i=0,len=overlayPNOARasterList.length;i<len;i++)if(overlayPNOARasterList[i].getProperties().year==year)return overlayPNOARasterList[i].getProperties()[nameProperty]}function getPropertyValueFromPNOAOverlaysByLayerkey(nameProperty,layerkey){for(var i=0,len=overlayPNOARasterList.length;i<len;i++)if(overlayPNOARasterList[i].getProperties().keyname==layerkey)return overlayPNOARasterList[i].getProperties()[nameProperty]}function getOBJlayerByKeyname(layerkey){for(var i=0,len=overlayPNOARasterList.length;i<len;i++)if(overlayPNOARasterList[i].getProperties().keyname==layerkey)return overlayPNOARasterList[i];for(i=0,len=overlayIGNRasterList.length;i<len;i++)if(overlayIGNRasterList[i].getProperties().keyname==layerkey)return overlayIGNRasterList[i];for(i=0,len=baseLayerList.length;i<len;i++)if(baseLayerList[i].getProperties().keyname==layerkey)return baseLayerList[i]}function getLayerSourceByKeyname(layerkey){for(var i=0,len=overlayPNOARasterList.length;i<len;i++)if(overlayPNOARasterList[i].getProperties().keyname==layerkey)return layerChange=overlayPNOARasterList[i],layerChange;for(i=0,len=overlayIGNRasterList.length;i<len;i++)if(overlayIGNRasterList[i].getProperties().keyname==layerkey)return layerChange=overlayIGNRasterList[i],layerChange;for(i=0,len=baseLayerList.length;i<len;i++)if(baseLayerList[i].getProperties().keyname==layerkey)return layerChange=baseLayerList[i],layerChange}function rasterIGNOverlays(visibilityDefault){for(var elemLyr,projectionExtent=projection.getExtent(),size=ol.extent.getWidth(projectionExtent)/256,resolutions=new Array(19),matrixIds=new Array(19),infoIcon="",z=0;z<19;++z)resolutions[z]=size/Math.pow(2,z),matrixIds[z]=z;var attributionGeneric=new ol.Attribution({html:'PNOA cedido por &copy; <a href="http://www.ign.es" target="_blank">Instituto Geográfico Nacional</a>'});$.getJSON("overlays-other.json",{get_param:"value"},function(data){var itemsATLayer=[],ctrlNames=[];itemsATLayer.push('<div class="panel panel-info" style="margin-left:0px;">'),itemsATLayer.push("<div class='panel-heading panel-heading-sm'><a id='btn-content-panel-ATLayers' href='#content-panel-ATLayers' data-toggle='collapse'><i class='fa fa-minus-square' aria-hidden='true'></i> Series MTN y Archivo Topográfico</a></div>"),itemsATLayer.push('<div id=\'content-panel-ATLayers\' class="panel-body collapse in" style="margin:5px; padding:0px;">'),$.each(data,function(index,element){if("WMS"==element.tiposerv?elemLyr=1==element.tileMode?new ol.layer.Tile({title:element.title,visible:visibilityDefault,source:new ol.source.TileWMS({attributions:[attributionGeneric],url:element.urlsource,params:{LAYERS:element.layernames,TILED:element.tileMode,FORMAT:element.imgformat}})}):new ol.layer.Image({title:element.title,visible:visibilityDefault,source:new ol.source.ImageWMS({attributions:[attributionGeneric],url:element.urlsource,params:{LAYERS:element.layernames,FORMAT:element.imgformat}})}):"WMTS"==element.tiposerv&&(elemLyr=new ol.layer.Tile({title:element.title,visible:visibilityDefault,extent:projectionExtent,opacity:1,source:new ol.source.XYZ({attributions:[attributionGeneric],url:element.urlsource+"?request=getTile&layer="+element.layernames+"&TileMatrixSet=GoogleMapsCompatible&TileMatrix={z}&TileCol={x}&TileRow={y}&format="+element.imgformat})})),elemLyr.set("nombre",element.title),elemLyr.set("tiposerv",element.tiposerv),elemLyr.set("group",element.group),elemLyr.set("queryable",element.queryable),elemLyr.set("useproxy",element.useproxy),elemLyr.set("urlQuery",element.GetFeatureInfo.urlQuery),elemLyr.set("layerQuery",element.GetFeatureInfo.layerQuery),elemLyr.set("keyname",element.layerkey),elemLyr.set("alias",element.alias),elemLyr.set("year",element.year),elemLyr.set("panel","ATLayers"),elemLyr.set("mostrarenpanel",element.mostrarenpanel),elemLyr.set("unicoenfila",element.unicoenfila),overlayIGNRasterList.push(elemLyr),objMap.addLayer(elemLyr),0<element.zindex&&setLayerZindex(objMap,element.layerkey,element.zindex),infoIcon=1==elemLyr.getProperties().queryable?"<i class='fa fa-list-alt' aria-hidden='true'></i>":"",1==elemLyr.getProperties().mostrarenpanel){var rtnCarro="";rtnCarro=1==element.unicoenfila?12:6,itemsATLayer.push('<div class="col-md-'+rtnCarro+" col-sm-"+rtnCarro+" col-xs-"+rtnCarro+'" style="margin-top:15px;"><input class="toolboxOverlayRaster" data-onstyle="success" data-toggle="toggle" data-on="<img src=\'img/eye16.png\'/> <small>'+element.title+" "+infoIcon+'</small>" data-off="'+element.title+" "+infoIcon+'" type="checkbox" data-width="160" data-size="mini" id="sidebarBtn'+element.layerkey+'"><div class="opacityLyrClass" id="opacityLyrElem'+element.layerkey+'"><div class="ui-slider-handle"><span style="display:none;" class="ui-slider-tooltip"></span></div></div></div>'),ctrlNames.push(element.layerkey)}}),itemsATLayer.push("</div></div>"),document.getElementById("panel-ATLayers").innerHTML=itemsATLayer.join(""),$("#content-panel-ATLayers").on("hide.bs.collapse",function(){$("#btn-content-panel-ATLayers").html("<i class='fa fa-plus-square' aria-hidden='true'></i> Series MTN y Archivo Topográfico</a></div>")}),$("#content-panel-ATLayers").on("show.bs.collapse",function(){$("#btn-content-panel-ATLayers").html("<i class='fa fa-minus-square' aria-hidden='true'></i> Series MTN y Archivo Topográfico</a></div>")});for(var i=0,len=ctrlNames.length;i<len;i++)$("#sidebarBtn"+ctrlNames[i]).bootstrapToggle();$(".toolboxOverlayRaster").change(function(){var id=$(this).prop("id"),value_id=$(this).prop("checked"),nomLayer=replaceAll(id,"sidebarBtn","");setLayerVisibleByKey(objMap,nomLayer,value_id);var capasActive=new Array;objMap.getLayers().forEach(function(layer,iLayer,layers){"imaginery-flight"!=layer.getProperties().group&&"imaginery-ign"!=layer.getProperties().group||1!=layer.getProperties().visible||capasActive.push(layer.getProperties().keyname)}),listaCapas=capasActive.join(",")}),$(".opacityLyrClass").slider({min:0,max:100,orientation:"horizontal",range:"min",value:100,slide:function(event,ui){var id=$(this).prop("id"),nomLayer=replaceAll(id,"opacityLyrElem","");$(this).find(".ui-slider-tooltip").text(ui.value),manageVisibleOverlaysByKeyname(objMap,nomLayer,"opacity",ui.value)},change:function(event,ui){},start:function(event,ui){$(this).find(".ui-slider-tooltip").fadeIn("fast")},stop:function(event,ui){$(this).find(".ui-slider-tooltip").fadeOut("fast")},create:function(event,ui){$(this).slider("value")}})})}function vectorOverLays(visibilityDefault){wmsSourceBDLJE=new ol.source.TileWMS({url:"http://www.ign.es/wms-inspire/unidades-administrativas",params:{LAYERS:"AU.AdministrativeBoundary",TILED:"true"},serverType:"geoserver",crossOrigin:""}),BDLJE_lyr=new ol.layer.Tile({title:"Lí­mites administrativos",visible:visibilityDefault,zIndex:901,source:new ol.source.TileWMS({url:"http://www.ign.es/wms-inspire/unidades-administrativas",params:{LAYERS:"AU.AdministrativeUnit",STYLES:"LimitesAdministrativos",FORMAT:"image/png",TILED:"true"}})}),BDLJE_lyr.set("keyname","BDLJE"),BDLJE_lyr.set("queryable",!0),BDLJE_lyr.set("group","Vector overlay"),BDLJE_lyr.set("alias","Líneas límite"),BDLJE_lyr.set("useproxy",!1),BDLJE_lyr.set("panel","AdminLayers"),BDLJE_lyr.set("abstract","Líneas límite municipales, provinciales y autonómicas. Capa con información asociada a la hoja registral"),overlayVectorList.push(BDLJE_lyr);var attributionCadastral=new ol.Attribution({html:'&copy; <a href="http://www.catastro.minhap.gob.es/esp/wms.asp"  target="_blank">Dirección General del Catastro</a>'});cadastralOverlay=new ol.layer.Image({title:"Catastro",visible:visibilityDefault,zIndex:903,source:new ol.source.ImageWMS({attributions:[attributionCadastral],url:"http://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx?",params:{VERSION:"1.1.1",LAYERS:"Catastro",SRS:"EPSG:3857",TILED:"false"},serverType:"geoserver"})}),cadastralOverlay.set("keyname","cadastral"),cadastralOverlay.set("group","Vector overlay"),cadastralOverlay.set("alias","Catastro"),cadastralOverlay.set("useproxy",!1),cadastralOverlay.set("panel","OtherLayers"),cadastralOverlay.set("abstract","Información del servicio publicado por al Dirección General del Catastro"),overlayVectorList.push(cadastralOverlay),cadastralINSPIREOverlay=new ol.layer.Image({title:"Catastro INSPIRE",visible:visibilityDefault,zIndex:904,source:new ol.source.ImageWMS({attributions:[attributionCadastral],url:"http://ovc.catastro.meh.es/cartografia/INSPIRE/spadgcwms.aspx?",params:{VERSION:"1.1.1",LAYERS:"AD.Address,BU.Building,BU.BuildingPart,AU.AdministrativeBoundary",SRS:"EPSG:3857",TILED:"false"},serverType:"geoserver"})}),cadastralINSPIREOverlay.set("keyname","cadastralINSPIRE"),cadastralINSPIREOverlay.set("group","Vector overlay"),cadastralINSPIREOverlay.set("alias","Catastro INSPIRE"),cadastralINSPIREOverlay.set("useproxy",!1),cadastralINSPIREOverlay.set("panel","OtherLayers"),cadastralINSPIREOverlay.set("abstract","Información del servicio publicado por al Dirección General del Catastro según normativa INSPIRE"),overlayVectorList.push(cadastralINSPIREOverlay),coastline_lyr=new ol.layer.Tile({title:"Lí­nea de costa",visible:visibilityDefault,zIndex:910,source:new ol.source.TileWMS({url:"http://ideihm.covam.es/wms/costaspain",params:{LAYERS:"HY",STYLES:"default",FORMAT:"image/png",TILED:"true"}})}),coastline_lyr.set("keyname","lineacosta"),coastline_lyr.set("group","Vector overlay"),coastline_lyr.set("alias","L­ínea de costa"),coastline_lyr.set("queryable",!1),coastline_lyr.set("useproxy",!1),coastline_lyr.set("panel","AdminLayers"),coastline_lyr.set("abstract","Línea de costa publicada por el Instituto Hidrográfico de la Marina"),overlayVectorList.push(coastline_lyr),baserecta_lyr=new ol.layer.Tile({title:"Líneas de base recta",visible:visibilityDefault,zIndex:909,source:new ol.source.TileWMS({url:"http://ideihm.covam.es/wms/limitesMAR",params:{LAYERS:"LBR",STYLES:"default",FORMAT:"image/png",TILED:"true"}})}),baserecta_lyr.set("keyname","baserecta"),baserecta_lyr.set("group","Vector overlay"),baserecta_lyr.set("alias","Líneas de base recta"),baserecta_lyr.set("queryable",!0),baserecta_lyr.set("useproxy",!1),baserecta_lyr.set("panel","AdminLayers"),baserecta_lyr.set("abstract","Líneas que limitan las aguas interiores a partir de la cual se mide el mar territorial. Capa con información asociada. Publicado por el Instituto Hidrográfico de la Marina"),overlayVectorList.push(baserecta_lyr),zee_lyr=new ol.layer.Tile({title:"ZEE",visible:visibilityDefault,zIndex:911,source:new ol.source.TileWMS({url:"http://ideihm.covam.es/wms/limitesMAR",params:{LAYERS:"ZEEE,ZEEE_textos",STYLES:"default",FORMAT:"image/png",TILED:"true"}})}),zee_lyr.set("keyname","ZEE"),zee_lyr.set("group","Vector overlay"),zee_lyr.set("alias","ZEE"),zee_lyr.set("queryable",!1),zee_lyr.set("useproxy",!1),zee_lyr.set("panel","AdminLayers"),zee_lyr.set("abstract","Zona económica exclusiva (200 millas). Publicado por el Instituto Hidrográfico de la Marina"),overlayVectorList.push(zee_lyr),pcymt_lyr=new ol.layer.Tile({title:"Mar territ.-Plat. cont",visible:visibilityDefault,zIndex:912,source:new ol.source.TileWMS({url:"http://ideihm.covam.es/wms/limitesMAR",params:{LAYERS:"PC,MT",STYLES:"default",FORMAT:"image/png",TILED:"true"}})}),pcymt_lyr.set("keyname","PCMT"),pcymt_lyr.set("group","Vector overlay"),pcymt_lyr.set("alias","Mar territorial-Plataforma"),pcymt_lyr.set("queryable",!1),pcymt_lyr.set("useproxy",!1),pcymt_lyr.set("panel","AdminLayers"),pcymt_lyr.set("abstract","Mar territorial y plataforma continental. Publicado por el Instituto Hidrográfico de la Marina"),overlayVectorList.push(pcymt_lyr),infoToponim=new ol.layer.Tile({title:"Toponimos",visible:visibilityDefault,zIndex:915,source:new ol.source.TileWMS({url:"http://www.ign.es/wms-inspire/ign-base",params:{LAYERS:"GN.GeographicalNames",TILED:"true"}})}),infoToponim.set("keyname","infoToponim"),infoToponim.set("group","Vector overlay"),infoToponim.set("alias","Topónimos"),infoToponim.set("queryable",!1),infoToponim.set("useproxy",!1),infoToponim.set("panel","OtherLayers"),infoToponim.set("abstract","Toponimia procedente del Nomenclátor"),overlayVectorList.push(infoToponim),infoComunicacion=new ol.layer.Tile({title:"Vías comunicación",visible:visibilityDefault,zIndex:914,source:new ol.source.TileWMS({url:"http://servicios.idee.es/wms-inspire/transportes",params:{LAYERS:"TN.RoadTransportNetwork.RoadLink",TILED:"true"}})}),infoComunicacion.set("keyname","infoComunicacion"),infoComunicacion.set("group","Vector overlay"),infoComunicacion.set("alias","Vías comunicación"),infoComunicacion.set("queryable",!0),infoComunicacion.set("useproxy",!0),infoComunicacion.set("panel","OtherLayers"),infoComunicacion.set("abstract","Red e Infraestructura del Transporte del Sistema Cartográfico Nacional. Capa con información asociada"),overlayVectorList.push(infoComunicacion);var itemsAdminLayers=[];itemsAdminLayers.push('<div class="panel panel-info" style="margin-left:0px;">'),itemsAdminLayers.push("<div class='panel-heading panel-heading-sm'><a id='btn-content-panel-AdminLayers' href='#content-panel-AdminLayers' data-toggle='collapse' class='collapsed'><i class='fa fa-plus-square' aria-hidden='true'></i> Divisiones administrativas</a></div>"),itemsAdminLayers.push('<div id=\'content-panel-AdminLayers\' class="panel-body collapse" style="margin:5px; padding:0px;">');var itemsOtherLayers=[];itemsOtherLayers.push('<div class="panel panel-info" style="margin-left:0px;">'),itemsOtherLayers.push("<div class='panel-heading panel-heading-sm'><a id='btn-content-panel-OtherLayers' href='#content-panel-OtherLayers' data-toggle='collapse' class='collapsed'><i class='fa fa-plus-square' aria-hidden='true'></i> Otras capas</a></div>"),itemsOtherLayers.push('<div id=\'content-panel-OtherLayers\' class="panel-body collapse" style="margin:5px; padding:0px;">');for(var infoIcon="",i=0,len=overlayVectorList.length;i<len;i++)infoIcon=1==overlayVectorList[i].getProperties().queryable?"<i class='fa fa-list-alt' aria-hidden='true'></i>":"","AdminLayers"==overlayVectorList[i].getProperties().panel&&itemsAdminLayers.push('<div class="col-md-6 col-sm-6 col-xs-6" data-toggle="tooltip" title="'+overlayVectorList[i].getProperties().abstract+'" style="margin-top:15px;"><input  class="toolboxOverlayVector" data-onstyle="success" data-toggle="toggle" data-width="160" data-size="mini" data-on="<img src=\'img/eye16.png\'/> <small>'+overlayVectorList[i].getProperties().alias+" "+infoIcon+'</small>" data-off="'+overlayVectorList[i].getProperties().alias+" "+infoIcon+'" type="checkbox" data-width="150" data-size="mini" id="sidebarBtn'+overlayVectorList[i].getProperties().keyname+'"></div>'),"OtherLayers"==overlayVectorList[i].getProperties().panel&&itemsOtherLayers.push('<div class="col-md-6 col-sm-6 col-xs-6" data-toggle="tooltip" title="'+overlayVectorList[i].getProperties().abstract+'" style="margin-top:15px;"><input class="toolboxOverlayVector" data-onstyle="success" data-toggle="toggle"  data-width="160" data-size="mini" data-on="<img src=\'img/eye16.png\'/> <small>'+overlayVectorList[i].getProperties().alias+" "+infoIcon+'</small>" data-off="'+overlayVectorList[i].getProperties().alias+" "+infoIcon+'" type="checkbox" data-width="150" data-size="mini" id="sidebarBtn'+overlayVectorList[i].getProperties().keyname+'"></div>');itemsAdminLayers.push("</div></div>"),itemsOtherLayers.push("</div></div>"),document.getElementById("panel-AdminLayers").innerHTML=itemsAdminLayers.join(""),document.getElementById("panel-OtherLayers").innerHTML=itemsOtherLayers.join(""),$("#content-panel-AdminLayers").on("hide.bs.collapse",function(){$("#btn-content-panel-AdminLayers").html("<i class='fa fa-plus-square' aria-hidden='true'></i> Divisiones administrativas</a></div>")}),$("#content-panel-AdminLayers").on("show.bs.collapse",function(){$("#btn-content-panel-AdminLayers").html("<i class='fa fa-minus-square' aria-hidden='true'></i> Divisiones administrativas</a></div>")}),$("#content-panel-OtherLayers").on("hide.bs.collapse",function(){$("#btn-content-panel-OtherLayers").html("<i class='fa fa-plus-square' aria-hidden='true'></i> Otras capas</a></div>")}),$("#content-panel-OtherLayers").on("show.bs.collapse",function(){$("#btn-content-panel-OtherLayers").html("<i class='fa fa-minus-square' aria-hidden='true'></i> Otras capas</a></div>")});for(i=0,len=overlayVectorList.length;i<len;i++)"gridMTN50Can"!=overlayVectorList[i].getProperties().keyname&&"gridMTN25Can"!=overlayVectorList[i].getProperties().keyname&&($("#sidebarBtn"+overlayVectorList[i].getProperties().keyname).bootstrapToggle(),objMap.addLayer(overlayVectorList[i]));$(".toolboxOverlayVector").change(function(){var id=$(this).prop("id"),value_id=$(this).prop("checked"),nomLayer=replaceAll(id,"sidebarBtn","");"gridMTN50Pen"==nomLayer?(setLayerVisibleByKey(objMap,"gridMTN50Pen",value_id),setLayerVisibleByKey(objMap,"gridMTN50Can",value_id)):"gridMTN25Pen"==nomLayer?(setLayerVisibleByKey(objMap,"gridMTN25Pen",value_id),setLayerVisibleByKey(objMap,"gridMTN25Can",value_id)):setLayerVisibleByKey(objMap,nomLayer,value_id)}),setLayerZindex(objMap,"parcelaskm",5e3)}