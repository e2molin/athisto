var objMap,objMapMirror,sidebar,showPNOAOnCursor,browserIE,mobileMode,modeViz,projection=ol.proj.get("EPSG:3857"),headerHeight=50,initLong=-5.5,initLat=40,initZoom=5,initMinZoom=5,initMaxZoom=18,initProj="EPSG:3857",listaCapas="",initHash="",actualHash="",pnoaSliderCobertura=new Array;function replaceAll(str,find,replace){return str.replace(new RegExp(find,"g"),replace)}function closeModals(){$("#permalinkText").modal("hide"),$("#btnPrinterSymbol").hide(),$("#toolTemporalTransitionElem").hide(),$("#panel-layers-PNOAoverlays").hide(),$("#panel-layers-AToverlays").hide(),$("#toolCoberInfoElem").hide(),6==modeViz&&($(".ign-mainmap-container").removeClass("col-sm-6").addClass("col-sm-12"),$(".ign-mirrormap-container").hide()),7==modeViz&&($(".ign-mainmap-container").removeClass("col-sm-6").addClass("col-sm-12"),$(".ign-mainmap-container").css("height",$(window).height()-75),$(".ign-mirrormap-container").hide()),$("#layerInfo1").text(""),$("#layerInfo2").text(""),$("#layerInfo3").text(""),$("#layerInfo4").text(""),$("#layerInfo5").text(""),$("#layerInfo6").text("")}function apagarOtrasViz(indexViz){0==indexViz?(setLayerVisibleByTitle(objMap,"Spot",0),setLayerVisibleByTitle(objMap,"SwipeE",0),setLayerVisibleByTitle(objMap,"SwipeW",0),setLayerVisibleByTitle(objMap,"SwipeN",0),setLayerVisibleByTitle(objMap,"SwipeS",0),setLayerVisibleByTitle(objMap,"MosaicNE",0),setLayerVisibleByTitle(objMap,"MosaicSE",0),setLayerVisibleByTitle(objMap,"MosaicNW",0),setLayerVisibleByTitle(objMap,"MosaicSW",0)):1==indexViz?(setLayerVisibleByTitle(objMap,"Spot",0),setLayerVisibleByTitle(objMap,"SwipeE",0),setLayerVisibleByTitle(objMap,"SwipeW",0),setLayerVisibleByTitle(objMap,"SwipeN",0),setLayerVisibleByTitle(objMap,"SwipeS",0)):2==indexViz?(setLayerVisibleByTitle(objMap,"Spot",0),setLayerVisibleByTitle(objMap,"SwipeN",0),setLayerVisibleByTitle(objMap,"SwipeS",0),setLayerVisibleByTitle(objMap,"MosaicNE",0),setLayerVisibleByTitle(objMap,"MosaicSE",0),setLayerVisibleByTitle(objMap,"MosaicNW",0),setLayerVisibleByTitle(objMap,"MosaicSW",0)):3==indexViz?(setLayerVisibleByTitle(objMap,"Spot",0),setLayerVisibleByTitle(objMap,"SwipeE",0),setLayerVisibleByTitle(objMap,"SwipeW",0),setLayerVisibleByTitle(objMap,"MosaicNE",0),setLayerVisibleByTitle(objMap,"MosaicSE",0),setLayerVisibleByTitle(objMap,"MosaicNW",0),setLayerVisibleByTitle(objMap,"MosaicSW",0)):4==indexViz?(setLayerVisibleByTitle(objMap,"SwipeE",0),setLayerVisibleByTitle(objMap,"SwipeW",0),setLayerVisibleByTitle(objMap,"MosaicNE",0),setLayerVisibleByTitle(objMap,"MosaicSE",0),setLayerVisibleByTitle(objMap,"MosaicNW",0),setLayerVisibleByTitle(objMap,"MosaicSW",0)):5<=indexViz&&(setLayerVisibleByTitle(objMap,"Spot",0),setLayerVisibleByTitle(objMap,"SwipeE",0),setLayerVisibleByTitle(objMap,"SwipeW",0),setLayerVisibleByTitle(objMap,"SwipeN",0),setLayerVisibleByTitle(objMap,"SwipeS",0),setLayerVisibleByTitle(objMap,"MosaicNE",0),setLayerVisibleByTitle(objMap,"MosaicSE",0),setLayerVisibleByTitle(objMap,"MosaicNW",0),setLayerVisibleByTitle(objMap,"MosaicSW",0))}String.prototype.beginsWith=function(string){return 0===this.indexOf(string)};var updatePermalink=function(){var shouldUpdate=!0,view=objMap.getView();if(shouldUpdate){var center=view.getCenter(),hash="#map="+view.getZoom()+"/"+Math.round(100*center[0])/100+"/"+Math.round(100*center[1])/100+"/"+view.getRotation()+"/"+modeViz+"/"+listaCapas,state={zoom:view.getZoom(),center:view.getCenter(),rotation:view.getRotation()};if(1==mobileMode||0==showPNOAOnCursor){var pixelCentral=objMap.getPixelFromCoordinate(objMap.getView().getCenter());displayPNOAInfo(pixelCentral,"layersAvailablesList","")}actualHash=""+hash,window.history.pushState(state,"Enlace web","index.html")}else shouldUpdate=!0};function processHash(){var permalinkModeViz;if(0!=initHash.beginsWith("#map="))if(""!==initHash){var parts=initHash.replace("#map=","").split("/");if(6===parts.length){zoom=parseInt(parts[0],10);var center=[parseFloat(parts[1]),parseFloat(parts[2])];rotation=parseFloat(parts[3]),permalinkModeViz=parseFloat(parts[4]),listaCapas=parts[5]}"undefined"!=typeof zoom&&null!==zoom||(zoom=initZoom),"undefined"!=typeof rotation&&null!==rotation||(rotation=0);var vistaPermalink=new ol.View({projection:"EPSG:3857",center:center,zoom:zoom,rotation:rotation,minZoom:4,maxZoom:19});objMap.setView(vistaPermalink),objMapMirror.setView(objMap.getView()),changeVizMode(permalinkModeViz)}else changeVizMode(1==mobileMode?6:0);else changeVizMode(1==mobileMode?6:0)}function mapsRendering(){setTimeout(function(){objMap.updateSize(),objMapMirror.updateSize()},0)}function changeVizMode(indexViz){if(modeViz!=indexViz){var pixelCentral=objMap.getPixelFromCoordinate(objMap.getView().getCenter());displayPNOAInfo(pixelCentral,"layersAvailablesList",""),closeModals();var capasHash=null;if(null!=listaCapas||(listacapas="mtn50edi1,mtn25edi1"),""!==listaCapas)capasHash=listaCapas.split(",");else if(1==indexViz||2==indexViz||3==indexViz||4==indexViz)capasHash=(listaCapas="mtn50edi1,mtn25edi1").split(",");setGroupVisibleByKey(objMap,"imaginery-flight",0),$(".toolboxOverlayRaster").bootstrapToggle("off"),$(".opacityLyrClass").slider("option","value",0),$("[id ^= btnViz]").removeClass("vizModeSelected"),0==indexViz?(apagarTodo(),$("#panel-layers-PNOAoverlays").show(),$("#panel-layers-AToverlays").show(),$("#toolTypeWindowViz").hide(),$("#toolInfoScreenElem").removeClass("toolInfoScreenClassRight toolInfoScreenClassLeft").addClass("toolInfoScreenClassLeft"),$("#btnVizStandard").addClass("vizModeSelected"),$("#btnHelpSymbol").show(),$("#btnVizModesSymbol").show(),$("#btnVizMode7").show()):1==indexViz?(4<=capasHash.length?(changeToMosaicViz(getOBJlayerByKeyname(capasHash[0]),getOBJlayerByKeyname(capasHash[1]),getOBJlayerByKeyname(capasHash[2]),getOBJlayerByKeyname(capasHash[3])),listaCapas=capasHash[0]+","+capasHash[1]+","+capasHash[2]+","+capasHash[3]):3==capasHash.length?(changeToMosaicViz(getOBJlayerByKeyname(capasHash[0]),getOBJlayerByKeyname(capasHash[1]),getOBJlayerByKeyname(capasHash[2]),getLayerSourceByKeyname("mapamtn")),listaCapas=capasHash[0]+","+capasHash[1]+","+capasHash[2]+",mapamtn"):2==capasHash.length?(changeToMosaicViz(getOBJlayerByKeyname(capasHash[0]),getOBJlayerByKeyname(capasHash[1]),getLayerSourceByKeyname("actualpnoa"),getLayerSourceByKeyname("mapamtn")),listaCapas=capasHash[0]+","+capasHash[1]+",actualpnoa,mapamtn"):1==capasHash.length?changeToMosaicViz(getOBJlayerByKeyname(capasHash[0]),overlayPNOARasterList[0],overlayPNOARasterList[1],overlayPNOARasterList[2]):changeToMosaicViz(baseLayerList[0],overlayPNOARasterList[1],overlayPNOARasterList[0],baseLayerList[1]),$("#toolTypeWindowViz").show(),$("#toolCoberInfoElem").show(),$("#toolInfoScreenElem").removeClass("toolInfoScreenClassRight toolInfoScreenClassLeft").addClass("toolInfoScreenClassLeft"),$("#btnVizMosaic").addClass("vizModeSelected"),$("#btnHelpSymbol").show(),$("#btnVizModesSymbol").show(),$("#btnVizMode7").show()):2==indexViz?(2<=capasHash.length?changeToVerticalSwipeViz(getOBJlayerByKeyname(capasHash[0]),getOBJlayerByKeyname(capasHash[1])):changeToVerticalSwipeViz(overlayPNOARasterList[0],overlayPNOARasterList[2]),$("#toolTypeWindowViz").show(),$("#toolCoberInfoElem").show(),$("#toolInfoScreenElem").removeClass("toolInfoScreenClassRight toolInfoScreenClassLeft").addClass("toolInfoScreenClassLeft"),$("#btnVizSwipeV").addClass("vizModeSelected"),$("#btnPrinterSymbol").show(),$("#btnHelpSymbol").show(),$("#btnVizModesSymbol").show(),$("#btnVizMode7").show()):3==indexViz?(2<=capasHash.length?changeToHorizontalSwipeViz(getOBJlayerByKeyname(capasHash[0]),getOBJlayerByKeyname(capasHash[1])):changeToHorizontalSwipeViz(overlayPNOARasterList[0],overlayPNOARasterList[2]),$("#toolTypeWindowViz").show(),$("#toolCoberInfoElem").show(),$("#toolInfoScreenElem").removeClass("toolInfoScreenClassRight toolInfoScreenClassLeft").addClass("toolInfoScreenClassLeft"),$("#btnVizSwipeH").addClass("vizModeSelected"),$("#btnPrinterSymbol").show(),$("#btnHelpSymbol").show(),$("#btnVizModesSymbol").show(),$("#btnVizMode7").show()):4==indexViz?(1<=capasHash.length?changeToSpotViz(getOBJlayerByKeyname(capasHash[0])):changeToSpotViz(overlayPNOARasterList[4]),$("#toolTypeWindowViz").hide(),$("#toolCoberInfoElem").show(),$("#toolInfoScreenElem").removeClass("toolInfoScreenClassRight toolInfoScreenClassLeft").addClass("toolInfoScreenClassLeft"),$("#btnVizSpot").addClass("vizModeSelected"),$("#btnHelpSymbol").show(),$("#btnVizModesSymbol").show(),$("#btnVizMode7").show()):5==indexViz?(apagarTodo(),$("#toolTemporalTransitionElem").show(),$("#toolCoberInfoElem").show(),$("#toolTypeWindowViz").hide(),$("#toolInfoScreenElem").removeClass("toolInfoScreenClassRight toolInfoScreenClassLeft").addClass("toolInfoScreenClassLeft"),$("#btnVizTimer").addClass("vizModeSelected"),$("#btnHelpSymbol").show(),$("#btnVizModesSymbol").show(),$("#btnVizMode7").show(),listaCapas=""):6==indexViz?(apagarTodo(),$(".ign-mainmap-container").removeClass("col-sm-12").addClass("col-sm-6"),$(".ign-mirrormap-container").hasClass("col-sm-12")&&$(".ign-mirrormap-container").removeClass("col-sm-12").addClass("col-sm-6"),$(".ign-mainmap-container").css("height",$(window).height()-headerHeight),$(".ign-mirrormap-container").css("height",$(window).height()-headerHeight),$(".ign-mirrormap-container").show(),$("#toolTypeWindowViz").hide(),$("#toolCoberInfoElem").show(),$("#btnPrinterSymbol").show(),$("#btnHelpSymbol").show(),$("#btnVizModesSymbol").show(),$("#btnVizMode7").show(),$("#toolInfoScreenElem").removeClass("toolInfoScreenClassRight toolInfoScreenClassLeft").addClass("toolInfoScreenClassRight"),$("#btnVizDoubleScreenV").addClass("vizModeSelected"),null==capasHash?($("#layerInfo1").text("Mapa"),$("#layerInfo2").text("Híbrido"),listaCapas="mapamtn,actualpnoa"):2<=capasHash.length?(asignaLayerPrincipal(capasHash[0],"cobselectorText1"),asignaLayerMirror(capasHash[1],"cobselectorText2")):listaCapas="mapamtn,actualpnoa"):7==indexViz&&(apagarTodo(),$(".ign-mainmap-container").hasClass("col-sm-6")&&$(".ign-mainmap-container").removeClass("col-sm-6").addClass("col-sm-12"),$(".ign-mirrormap-container").hasClass("col-sm-6")&&$(".ign-mirrormap-container").removeClass("col-sm-6").addClass("col-sm-12"),$(".ign-mainmap-container").css("height",($(window).height()-headerHeight)/2),$(".ign-mirrormap-container").css("height",($(window).height()-headerHeight)/2),$(".ign-mirrormap-container").show(),$("#toolCoberInfoElem").show(),$("#toolTypeWindowViz").hide(),$("#btnPrinterSymbol").show(),$("#btnHelpSymbol").hide(),$("#btnVizModesSymbol").hide(),$("#btnVizMode7").hide(),$("#toolInfoScreenElem").removeClass("toolInfoScreenClassRight toolInfoScreenClassLeft").addClass("toolInfoScreenClassLeft"),$("#btnVizDoubleScreenH").addClass("vizModeSelected"),null==capasHash?($("#layerInfo5").text("Mapa"),$("#layerInfo6").text("Híbrido"),listaCapas="mapamtn,actualpnoa"):2<=capasHash.length?(asignaLayerPrincipal(capasHash[0],"cobselectorText1"),asignaLayerMirror(capasHash[1],"cobselectorText2")):listaCapas="mapamtn,actualpnoa"),apagarOtrasViz(indexViz),6==indexViz&&mapsRendering(),6==modeViz&&mapsRendering(),7==indexViz&&mapsRendering(),7==modeViz&&mapsRendering(),0==indexViz&&mapsRendering(),0==modeViz&&mapsRendering(),modeViz=indexViz;pixelCentral=objMap.getPixelFromCoordinate(objMap.getView().getCenter());displayPNOAInfo(pixelCentral,"layersAvailablesList","")}}function dynamicPNOAoverlayOpacity(valueCoberturaRanger){var valueSlider=valueCoberturaRanger,parteEntera=parseInt(valueSlider),parteDecimal=parseFloat(valueSlider)-parseInt(valueSlider),parteDecimalInversa=1-(parseFloat(valueSlider)-parseInt(valueSlider));if(0==parteDecimal)return setLayerPNOAVisibilityAndOpacityByKey(objMap,"imaginery-flight",pnoaSliderCobertura[parteEntera-1],1,1,!0),void(null==pnoaSliderCobertura[parteEntera-1]?$("#coberturaDisplayInfo").html(""):$("#coberturaDisplayInfo").html("Mostrando "+getPropertyValueFromPNOAOverlaysByYear("title",pnoaSliderCobertura[parteEntera-1])));valueSlider<1?(setLayerPNOAVisibilityAndOpacityByKey(objMap,"imaginery-flight",pnoaSliderCobertura[parteEntera],1,parteDecimal,!0),$("#coberturaDisplayInfo").html("Mostrando "+getPropertyValueFromPNOAOverlaysByYear("title",pnoaSliderCobertura[parteEntera]))):(setLayerPNOAVisibilityAndOpacityByKey(objMap,"imaginery-flight",pnoaSliderCobertura[parteEntera-1],1,parteDecimalInversa,!0),setLayerPNOAVisibilityAndOpacityByKey(objMap,"imaginery-flight",pnoaSliderCobertura[parteEntera],1,parteDecimal,!1),$("#coberturaDisplayInfo").html("Mostrando "+getPropertyValueFromPNOAOverlaysByYear("title",pnoaSliderCobertura[parteEntera-1])+" y "+getPropertyValueFromPNOAOverlaysByYear("title",pnoaSliderCobertura[parteEntera])))}function procesarLayerSelected(nomLayer){if(0==modeViz)return $("#sidebarBtn"+nomLayer).bootstrapToggle("toggle"),void(1==$("#sidebarBtn"+nomLayer).prop("checked")?$("#selcob"+nomLayer).addClass("btn-success"):$("#selcob"+nomLayer).removeClass("btn-success"));if($("#sel-LayerViz").text(nomLayer),1==modeViz)$("#sel-mosaicViz").fadeIn();else if(2==modeViz)$("#sel-swipeVViz").fadeIn();else if(3==modeViz)$("#sel-swipeHViz").fadeIn();else if(4==modeViz){for(var i=0,len=overlayPNOARasterList.length;i<len;i++)if(overlayPNOARasterList[i].getProperties().keyname==nomLayer){changeToSpotViz(overlayPNOARasterList[i]);break}for(i=0,len=baseLayerList.length;i<len;i++)if(baseLayerList[i].getProperties().keyname==nomLayer){changeToSpotViz(baseLayerList[i]);break}}else if(5==modeViz)for(i=0,len=pnoaSliderCobertura.length;i<len;i++)pnoaSliderCobertura[i]==getPropertyValueFromPNOAOverlaysByLayerkey("year",nomLayer)&&($("#temporalLevel").slider("value",i+1),dynamicPNOAoverlayOpacity(i+1));else 6==modeViz?$("#sel-mirrorVViz").fadeIn():7==modeViz&&$("#sel-mirrorHViz").fadeIn()}function procesarLayerSelectedDirect(nomLayer,container){if(0==modeViz)return $("#sidebarBtn"+nomLayer).bootstrapToggle("toggle"),void(1==$("#sidebarBtn"+nomLayer).prop("checked")?$("#selcob"+nomLayer).addClass("btn-success"):$("#selcob"+nomLayer).removeClass("btn-success"));if(1==modeViz)layerChange=getLayerSourceByKeyname(nomLayer),"cobselector1"==container?(changeLayerInMosaicViz(layerChange,"NW"),$("#cobselectorText1").text(layerChange.getProperties().alias)):"cobselector2"==container?(changeLayerInMosaicViz(layerChange,"NE"),$("#cobselectorText2").text(layerChange.getProperties().alias)):"cobselector3"==container?(changeLayerInMosaicViz(layerChange,"SW"),$("#cobselectorText3").text(layerChange.getProperties().alias)):"cobselector4"==container&&(changeLayerInMosaicViz(layerChange,"SE"),$("#cobselectorText4").text(layerChange.getProperties().alias)),hideSelectorPanel();else if(2==modeViz){layerChange=getLayerSourceByKeyname(nomLayer),"cobselector1"==container&&(changeLayerInVerticalSwipeViz(layerChange,"West"),$("#cobselectorText1").text(layerChange.getProperties().alias)),"cobselector2"==container&&(changeLayerInVerticalSwipeViz(layerChange,"East"),$("#cobselectorText2").text(layerChange.getProperties().alias)),hideSelectorPanel()}else if(3==modeViz){layerChange=getLayerSourceByKeyname(nomLayer),"cobselector1"==container?(changeLayerInHorizontalSwipeViz(layerChange,"North"),$("#cobselectorText1").text(layerChange.getProperties().alias)):(changeLayerInHorizontalSwipeViz(layerChange,"South"),$("#cobselectorText2").text(layerChange.getProperties().alias)),hideSelectorPanel()}else if(4==modeViz){var layerChange;layerChange=getLayerSourceByKeyname(nomLayer),changeToSpotViz(layerChange),$("#cobselectorText1").text(layerChange.getProperties().alias)}else if(5==modeViz)for(var i=0,len=pnoaSliderCobertura.length;i<len;i++)pnoaSliderCobertura[i]==getPropertyValueFromPNOAOverlaysByLayerkey("year",nomLayer)&&($("#temporalLevel").slider("value",i+1),dynamicPNOAoverlayOpacity(i+1));else if(6==modeViz){listaCapas.split(",");"cobselector1"==container&&asignaLayerPrincipal(nomLayer,"cobselectorText1"),"cobselector2"==container&&asignaLayerMirror(nomLayer,"cobselectorText2"),hideSelectorPanel()}else if(7==modeViz){listaCapas.split(",");"cobselector1"==container&&asignaLayerPrincipal(nomLayer,"cobselectorText1"),"cobselector2"==container&&asignaLayerMirror(nomLayer,"cobselectorText2"),hideSelectorPanel()}}$("#content-panel-layers-User").on("hide.bs.collapse",function(){$("#btn-content-panel-layers-User").html("<i class='fa fa-plus-square' aria-hidden='true'></i> Capas de usuario</a></div>")}),$("#content-panel-layers-User").on("show.bs.collapse",function(){$("#btn-content-panel-layers-User").html("<i class='fa fa-minus-square' aria-hidden='true'></i> Capas de usuario</a></div>")}),$("#temporalLevel").slider({min:0,max:100,orientation:"horizontal",value:0,step:.01,slide:function(event,ui){dynamicPNOAoverlayOpacity(ui.value)}}),$("#opacityLevel").slider({min:0,max:100,orientation:"horizontal",value:100,slide:function(event,ui){ui.value<=10?($("#lblOpacidad").css("background-color","#ff6666"),$("#lblOpacidad").css("font-weight","bold"),$("#lblOpacidad").text("Opacidad < 10%")):($("#lblOpacidad").css("background-color","transparent"),$("#lblOpacidad").css("font-weight","normal"),$("#lblOpacidad").text("Opacidad")),1==modeViz&&(manageVisibleOverlaysByTitle(objMap,"MosaicNW","opacity",ui.value),manageVisibleOverlaysByTitle(objMap,"MosaicNE","opacity",ui.value),manageVisibleOverlaysByTitle(objMap,"MosaicSW","opacity",ui.value),manageVisibleOverlaysByTitle(objMap,"MosaicSE","opacity",ui.value)),2==modeViz&&(manageVisibleOverlaysByTitle(objMap,"SwipeE","opacity",ui.value),manageVisibleOverlaysByTitle(objMap,"SwipeW","opacity",ui.value)),3==modeViz&&(manageVisibleOverlaysByTitle(objMap,"SwipeN","opacity",ui.value),manageVisibleOverlaysByTitle(objMap,"SwipeS","opacity",ui.value)),6!=modeViz&&7!=modeViz||(manageVisibleOverlaysByGroup(objMap,"imaginery-flight","opacity",ui.value),manageVisibleOverlaysByGroup(objMap,"imaginery-ign","opacity",ui.value),manageVisibleOverlaysByTitle(objMapMirror,"Overlay Mirror","opacity",ui.value))}}),$("#set-mapMain-mapa").click(function(){$("#set-mapMain-mapa").hasClass("selected")||($(".btnGroupLayerChangeMainMap a").removeClass("selected"),$("#set-mapMain-mapa").addClass("selected"),setLayerVisibleByIndex(objMap,0,1),setLayerVisibleByIndex(objMap,1,0),setLayerVisibleByIndex(objMap,2,0))}),$("#set-mapMain-imagen").click(function(){$("#set-mapMain-imagen").hasClass("selected")||($(".btnGroupLayerChangeMainMap a").removeClass("selected"),$("#set-mapMain-imagen").addClass("selected"),setLayerVisibleByIndex(objMap,0,0),setLayerVisibleByIndex(objMap,1,1),setLayerVisibleByIndex(objMap,2,0))}),$("#set-mapMain-hibrido").click(function(){$("#set-mapMain-hibrido").hasClass("selected")||($(".btnGroupLayerChangeMainMap a").removeClass("selected"),$("#set-mapMain-hibrido").addClass("selected"),setLayerVisibleByIndex(objMap,0,0),setLayerVisibleByIndex(objMap,1,1),setLayerVisibleByIndex(objMap,2,1))}),$("#set-showTools").click(function(){$("#toolbarMappingElem").toggle()}),$("#set-showInfo").click(function(){BootstrapDialog.alert({title:"Obtener información de las capas",message:"Active la capa vectorial de líneas límite y haga clic sobre una linea límite o un municipio para ver su información asociada.<br/>Las capas con el símbolo <i class='fa fa-info-circle' aria-hidden='true'></i> contienen información que se mostrará al hacer clic con la capa activada."})}),$("#set-CDC").click(function(){var extent=objMap.getView().calculateExtent(objMap.getSize()),urlCDD="http://centrodedescargas.cnig.es/CentroDescargas/buscador.do?crs=EPSG:4258&BBOX="+(extent=ol.proj.transformExtent(extent,"EPSG:3857","EPSG:4326"))[0]+","+extent[1]+","+extent[2]+","+extent[3];window.open(urlCDD,"_blank")}),$("#set-mapMirror-mapa").click(function(){listaCapas.split(",");$("#set-mapMirror-mapa").hasClass("selected")||($(".btnGroupLayerChangeMirrorMap a").removeClass("selected"),$("#set-mapMirror-mapa").addClass("selected"),setLayerVisibleByIndex(objMapMirror,0,1),setLayerVisibleByIndex(objMapMirror,1,0),setLayerVisibleByIndex(objMapMirror,2,0),6==modeViz&&$("#layerInfo2").text("Mapa"),7==modeViz&&$("#layerInfo6").text("Mapa"))}),$("#set-mapMirror-imagen").click(function(){listaCapas.split(",");$("#set-mapMirror-imagen").hasClass("selected")||($(".btnGroupLayerChangeMirrorMap a").removeClass("selected"),$("#set-mapMirror-imagen").addClass("selected"),setLayerVisibleByIndex(objMapMirror,0,0),setLayerVisibleByIndex(objMapMirror,1,1),setLayerVisibleByIndex(objMapMirror,2,0),6==modeViz&&$("#layerInfo2").text("Imagen"),7==modeViz&&$("#layerInfo6").text("Imagen"))}),$("#set-mapMirror-hibrido").click(function(){listaCapas.split(",");$("#set-mapMirror-hibrido").hasClass("selected")||($(".btnGroupLayerChangeMirrorMap a").removeClass("selected"),$("#set-mapMirror-hibrido").addClass("selected"),setLayerVisibleByIndex(objMapMirror,0,0),setLayerVisibleByIndex(objMapMirror,1,1),setLayerVisibleByIndex(objMapMirror,2,1),6==modeViz&&$("#layerInfo2").text("Híbrido"),7==modeViz&&$("#layerInfo6").text("Híbrido"))}),$("#btnPrint").click(function(){var center=objMap.getView().getCenter();xCenter=Math.round(100*center[0])/100,yCenter=Math.round(100*center[1])/100,zoom=2,1==modeViz?window.open("php/printMosaic.php?cooCentroX="+xCenter+"&cooCentroY="+yCenter+"&zoom="+zoom+"&listacapas="+listaCapas):2==modeViz?window.open("php/printVerticalCurtain.php?cooCentroX="+xCenter+"&cooCentroY="+yCenter+"&zoom="+zoom+"&listacapas="+listaCapas):3==modeViz?window.open("php/printHorizontalCurtain.php?cooCentroX="+xCenter+"&cooCentroY="+yCenter+"&zoom="+zoom+"&listacapas="+listaCapas):6==modeViz?window.open("php/printVertical.php?cooCentroX="+xCenter+"&cooCentroY="+yCenter+"&zoom="+zoom+"&listacapas="+listaCapas):7==modeViz&&window.open("php/printHorizontal.php?cooCentroX="+xCenter+"&cooCentroY="+yCenter+"&zoom="+zoom+"&listacapas="+listaCapas)}),$("#btnSocial").click(function(){updatePermalink();$("#permalinkText").text(window.location.href+actualHash),$("#btnSocialFacebook").attr("href","https://www.facebook.com/sharer.php?u="+replaceAll($("#permalinkText").text(),"#","%23")+"&t=Comparador del PNOA"),$("#btnSocialTwitter").attr("href","http://twitter.com/intent/tweet?text=Comparador del PNOA&url="+replaceAll($("#permalinkText").text(),"#","%23")),$("#btnSocialGooglePlus").attr("href","https://plus.google.com/share?url="+replaceAll($("#permalinkText").text(),"#","%23")),$("#bidienlace").attr("src","https://api.qrserver.com/v1/create-qr-code/?size=150x150&data="+replaceAll($("#permalinkText").text(),"#","%23")),$("#modalInfoPermalink").modal("show")}),$("#btnTest").click(function(){}),$("#btnVizStandard, #btnVizMosaic, #btnVizSwipeV, #btnVizSwipeH, #btnVizSpot, #btnVizTimer, #btnVizDoubleScreenV, #btnVizDoubleScreenH").click(function(){"btnVizStandard"==$(this).attr("id")?changeVizMode(0):"btnVizMosaic"==$(this).attr("id")?changeVizMode(1):"btnVizSwipeV"==$(this).attr("id")?changeVizMode(2):"btnVizSwipeH"==$(this).attr("id")?changeVizMode(3):"btnVizSpot"==$(this).attr("id")?changeVizMode(4):"btnVizTimer"==$(this).attr("id")?changeVizMode(5):"btnVizDoubleScreenV"==$(this).attr("id")?changeVizMode(6):"btnVizDoubleScreenH"==$(this).attr("id")&&changeVizMode(7)}),$("#btnHelpVizStandard, #btnHelpVizMosaic, #btnHelpVizSwipeV, #btnHelpVizSwipeH, #btnHelpVizSpot, #btnHelpVizTimer, #btnHelpVizDoubleScreenV, #btnHelpVizDoubleScreenH").click(function(){"btnHelpVizStandard"==$(this).attr("id")?changeVizMode(0):"btnHelpVizMosaic"==$(this).attr("id")?changeVizMode(1):"btnHelpVizSwipeV"==$(this).attr("id")?changeVizMode(2):"btnHelpVizSwipeH"==$(this).attr("id")?changeVizMode(3):"btnHelpVizSpot"==$(this).attr("id")?changeVizMode(4):"btnHelpVizTimer"==$(this).attr("id")?changeVizMode(5):"btnHelpVizDoubleScreenV"==$(this).attr("id")?changeVizMode(6):"btnHelpVizDoubleScreenH"==$(this).attr("id")&&changeVizMode(7),sidebar.close()}),$("#btnTypeWindowViz").change(function(event){fixedSizes=$(this).prop("checked")});var displayPNOAInfo=function(pixel,targetContainer,textoInfo){var textSelect=[],textoPrevio=["","","",""],nameClass="";pnoaSliderCobertura=[];for(var i=1,len=textoPrevio.length;i<=len;i++)textoPrevio[i-1]=$("#cobselectorText"+i).text();0==modeViz||4==modeViz||5==modeViz?(textSelect.push('<div id="cobSelectorContainerNNumber" class="btn-group btn-flex dropup col-xs-12" style="display:none;">'),$("#opacityLevelContainer").hide()):(3==modeViz||7==modeViz?textSelect.push('<div id="cobSelectorContainerNNumber" class="btn-group btn-flex dropup col-xs-12" style="display:none;">'):textSelect.push('<div id="cobSelectorContainerNNumber" class="btn-group btn-flex dropup col-xs-6" style="display:none;">'),$("#opacityLevelContainer").show()),textSelect.push('<button id="cobselectorTextNNumber" type="button" class="btn btn-default btn-xs"></button>'),textSelect.push('<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),textSelect.push('<span class="caret"></span>'),textSelect.push('<span class="sr-only">Toggle Dropdown</span>'),textSelect.push("</button>"),textSelect.push('<ul id="cobselectorNNumber" class="dropdown-menu">');for(i=0,len=overlayIGNRasterList.length;i<len;i++)nameClass="","imaginery-ign"==overlayIGNRasterList[i].getProperties().group&&textSelect.push('<li id="selcob'+overlayIGNRasterList[i].getProperties().keyname+'" class="'+nameClass+'"><a data="'+overlayIGNRasterList[i].getProperties().keyname+'" href="#"><i class="fa fa-map" aria-hidden="true"></i> '+overlayIGNRasterList[i].getProperties().nombre+"</a></li>");for(i=0,len=overlayPNOARasterList.length;i<len;i++)nameClass="",textSelect.push('<li id="selcob'+overlayPNOARasterList[i].getProperties().keyname+'" class="'+nameClass+'"><a data="'+overlayPNOARasterList[i].getProperties().keyname+'" href="#"><i class="fa fa-plane" aria-hidden="true"></i> '+overlayPNOARasterList[i].getProperties().nombre+"</a></li>");textSelect.push("</ul></div>"),[].sort(),document.getElementById(targetContainer).innerHTML='<div class="row">'+replaceAll(textSelect.join(""),"NNumber","1")+replaceAll(textSelect.join(""),"NNumber","2")+'</div><div class="row">'+replaceAll(textSelect.join(""),"NNumber","3")+replaceAll(textSelect.join(""),"NNumber","4")+"</div>"+textoInfo,1==modeViz?($("#cobSelectorContainer1").show(),$("#cobSelectorContainer2").show(),$("#cobSelectorContainer3").show(),$("#cobSelectorContainer4").show()):0==modeViz||4==modeViz||5==modeViz?$("#cobSelectorContainer1").show():($("#cobSelectorContainer1").show(),$("#cobSelectorContainer2").show()),hideSelectorPanel(),pnoaSliderCobertura.sort(),$("#temporalLevel").slider("option","max",pnoaSliderCobertura.length),$("#cobselector1 li a").click(function(){$(this).text();var nomLayer=$(this).attr("data");"nothing"!=nomLayer&&procesarLayerSelectedDirect(nomLayer,"cobselector1")}),$("#cobselector2 li a").click(function(){$(this).text();var nomLayer=$(this).attr("data");"nothing"!=nomLayer&&procesarLayerSelectedDirect(nomLayer,"cobselector2")}),1==modeViz&&($("#cobselector3 li a").click(function(){$(this).text();var nomLayer=$(this).attr("data");"nothing"!=nomLayer&&procesarLayerSelectedDirect(nomLayer,"cobselector3")}),$("#cobselector4 li a").click(function(){$(this).text();var nomLayer=$(this).attr("data");"nothing"!=nomLayer&&procesarLayerSelectedDirect(nomLayer,"cobselector4")}));for(i=1,len=textoPrevio.length;i<=len;i++)"Selecciona capa"!=textoPrevio[i-1]&&""!=textoPrevio[i-1]?$("#cobselectorText"+i).text(textoPrevio[i-1]):$("#cobselectorText"+i).text("Selecciona capa");$(".btnChangeLayerDisplay").on("click",function(event){procesarLayerSelected(replaceAll(event.target.id,"cob",""))})};function mirrorMap(){objMapMirror=new ol.Map({layers:[capasBaseMirror[0],capasBaseMirror[1],capasBaseMirror[2],new ol.layer.Tile({title:"Overlay Mirror",visible:!1})],target:"mapMirrorLienzo",logo:!1,controls:ol.control.defaults({zoom:1!=mobileMode,attribution:1!=mobileMode,attributionOptions:{collapsible:!0,tipLabel:"Créditos",label:"C"}}).extend([]),view:objMap.getView()})}function basicMap(){objMap=new ol.Map({layers:[capasBaseMain[0],capasBaseMain[1],capasBaseMain[2]],target:"mapLienzo",controls:ol.control.defaults({attributionOptions:{collapsible:!0}}),view:new ol.View({projection:"EPSG:3857",center:ol.proj.transform([initLong,initLat],"EPSG:4326","EPSG:3857"),zoom:initZoom,minZoom:initMinZoom,maxZoom:initMaxZoom})}),activateHorizontalSwipeViz(waterColorOSM_lyr,blackWhiteOSM_lyr,0),activateVerticalSwipeViz(basicOSM_lyr,basicOSM2_lyr,0),activateMosaicViz(actualPNOA_lyr,baseIGN_lyr,siose_lyr,mdtign_lyr,0),activateSpotViz(geologicoMinero_lyr,0),loadVizModes(),sidebar=new ol.control.Sidebar({element:"sidebar",position:"left"}),objMap.addControl(sidebar);var mousePositionControl=new ol.control.MousePosition({className:"ol-mouse-position",coordinateFormat:function(coordinate){return 36<=coordinate[1]&&-10<=coordinate[0]?ol.coordinate.format(coordinate,dvmGetEscalaNormalizada(objMap.getView().getZoom())+" (Zoom: "+objMap.getView().getZoom()+")<br/>ETRS89 ({x}, {y})",5):ol.coordinate.format(coordinate,dvmGetEscalaNormalizada(objMap.getView().getZoom())+" (Zoom: "+objMap.getView().getZoom()+")<br/>WGS84 ({x}, {y})",5)},projection:"EPSG:4326",undefinedHTML:"&nbsp;"});objMap.addControl(mousePositionControl),objMap.on("pointermove",function(evt){evt.dragging}),objMap.on("singleclick",function(evt){evt.dragging||1!=beginMeasurement&&onPointerClick(evt)}),objMap.on("moveend",updatePermalink),window.addEventListener("popstate",function(event){null!==event.state&&(objMap.getView().setCenter(event.state.center),objMap.getView().setZoom(event.state.zoom),objMap.getView().setRotation(event.state.rotation),shouldUpdate=!1)})}function setSizes(){$(window).width()<"768"?(mobileMode=!0,headerHeight=35,$("#btnVizMode6").hide(),$("#btnVizMode4").hide()):(mobileMode=!1,headerHeight=50,$("#btnVizMode6").show(),$("#btnVizMode4").show()),7==modeViz?($(".ign-mainmap-container").css("height",($(window).height()-headerHeight)/2),$(".ign-mirrormap-container").css("height",($(window).height()-headerHeight)/2)):($(".ign-mainmap-container").css("height",$(window).height()-headerHeight),$(".ign-mirrormap-container").css("height",$(window).height()-headerHeight))}$(window).resize(function(){setSizes()}),$(document).ready(function(){browserIE=detectIE(),initHash=window.location.hash,mobileMode=showPNOAOnCursor=!1,modeViz=-1,$("#btnTypeWindowViz").bootstrapToggle("on"),$(window).resize(function(){setSizes()}),loadBasicOSM(!1),loadBasicIGN(!1),rasterIGNOverlays(!1),cargaCapasBaseMain(),cargaCapasBaseMirror(),basicMap(),mirrorMap(),rasterPNOAOverlays(!1),setSizes(),mapsRendering(),activateMeasurementTools(objMap),init_activateDD(),$('[data-toggle="tooltip"]').tooltip()});