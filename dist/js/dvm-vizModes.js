var radius=75,spotOpacity=100,container=document.getElementById("mapLienzo"),pixelPos=null,fixedSizes=!0,vizLayerGroup=null,vizLayerList=new Array,spot_Lyr=null,nw_Lyr=null,ne_Lyr=null,sw_Lyr=null,se_Lyr=null,west_Lyr=null,east_Lyr=null,north_Lyr=null,south_Lyr=null;function hideSelectorPanel(){$("#sel-mosaicViz").hide(),$("#sel-swipeVViz").hide(),$("#sel-swipeHViz").hide(),$("#sel-mirrorVViz").hide(),$("#sel-mirrorHViz").hide()}function asignaLayerPrincipal(keyLayer,textoInfoID){for(var flagAsign=!1,capasMirror=listaCapas.split(","),i=0,len=overlayPNOARasterList.length;i<len;i++)overlayPNOARasterList[i].getProperties().keyname==keyLayer&&($("input[id^='sidebarBtn']").bootstrapToggle("off"),$("#sidebarBtn"+keyLayer).bootstrapToggle("on"),$("#"+textoInfoID).text(overlayPNOARasterList[i].getProperties().alias),listaCapas=overlayPNOARasterList[i].getProperties().keyname+","+capasMirror[1],flagAsign=!0);if(!flagAsign){for(i=0,len=baseLayerList.length;i<len;i++)$("input[id^='sidebarBtn']").bootstrapToggle("off"),$("#sidebarBtn"+keyLayer).bootstrapToggle("on"),$("#"+textoInfoID).text(baseLayerList[i].getProperties().alias),listaCapas=baseLayerList[i].getProperties().keyname+","+capasMirror[1],flagAsign=!0;if(!flagAsign)for(i=0,len=overlayIGNRasterList.length;i<len;i++)overlayIGNRasterList[i].getProperties().keyname==keyLayer&&($("input[id^='sidebarBtn']").bootstrapToggle("off"),$("#sidebarBtn"+keyLayer).bootstrapToggle("on"),$("#"+textoInfoID).text(overlayIGNRasterList[i].getProperties().alias),listaCapas=overlayIGNRasterList[i].getProperties().keyname+","+capasMirror[1],flagAsign=!0)}}function asignaLayerMirror(keyLayer,textoInfoID){for(var flagAsign=!1,capasMirror=listaCapas.split(","),i=0,len=overlayPNOARasterList.length;i<len;i++)if(overlayPNOARasterList[i].getProperties().keyname==keyLayer){objMapMirror.getLayers().forEach(function(layer,iLayer,layers){3==iLayer&&(layer.setSource(overlayPNOARasterList[i].getSource()),layer.setVisible(1),$("#"+textoInfoID).text(overlayPNOARasterList[i].getProperties().alias),listaCapas=capasMirror[0]+","+overlayPNOARasterList[i].getProperties().keyname,flagAsign=!0)});break}if(!flagAsign){for(i=0,len=baseLayerList.length;i<len;i++)if(baseLayerList[i].getProperties().keyname==keyLayer){objMapMirror.getLayers().forEach(function(layer,iLayer,layers){3==iLayer&&(layer.setSource(baseLayerList[i].getSource()),layer.setVisible(1),$("#"+textoInfoID).text(baseLayerList[i].getProperties().alias),listaCapas=capasMirror[0]+","+baseLayerList[i].getProperties().keyname,flagAsign=!0)});break}if(!flagAsign)for(i=0,len=overlayIGNRasterList.length;i<len;i++)if(overlayIGNRasterList[i].getProperties().keyname==keyLayer){objMapMirror.getLayers().forEach(function(layer,iLayer,layers){3==iLayer&&(layer.setSource(overlayIGNRasterList[i].getSource()),layer.setVisible(1),$("#"+textoInfoID).text(overlayIGNRasterList[i].getProperties().alias),listaCapas=capasMirror[0]+","+overlayIGNRasterList[i].getProperties().keyname,flagAsign=!0)});break}}}var drawVerticalSwipe=new ol.interaction.Draw({type:"Polygon",source:new ol.source.Vector,style:new ol.style.Style({image:new ol.style.Icon({src:"img/swipeVertical.png",size:[64,64],opacity:1,scale:.4})})}),drawHorizontalSwipe=new ol.interaction.Draw({type:"Polygon",source:new ol.source.Vector,style:new ol.style.Style({image:new ol.style.Icon({src:"img/swipeHorizontal.png",size:[64,64],opacity:1,scale:.4})})});function activateSpotViz(spotLayer,visibleInit){(spot_Lyr=spotLayer).set("title","Spot"),spot_Lyr.set("keyname","spotLyr"),spot_Lyr.setVisible(visibleInit),spotOpacity=100,spot_Lyr.setOpacity(spotOpacity/100),spot_Lyr.on("precompose",function(event){var ctx=event.context,pixelRatio=event.frameState.pixelRatio;ctx.save(),ctx.beginPath(),mousePosition&&(ctx.arc(mousePosition[0]*pixelRatio,mousePosition[1]*pixelRatio,radius*pixelRatio,0,2*Math.PI),ctx.lineWidth=5*pixelRatio,ctx.strokeStyle="rgba(0,0,0,0.5)",ctx.stroke()),ctx.clip()}),spot_Lyr.on("postcompose",function(event){event.context.restore()}),vizLayerList.push(spot_Lyr)}function activateMosaicViz(NWLayer,NELayer,SWLayer,SELayer,visibleInit){(nw_Lyr=NWLayer).set("title","MosaicNW"),nw_Lyr.set("keyname","mosaicNW"),nw_Lyr.setVisible(visibleInit),(ne_Lyr=NELayer).set("title","MosaicNE"),ne_Lyr.set("keyname","mosaicNE"),ne_Lyr.setVisible(visibleInit),(sw_Lyr=SWLayer).set("title","MosaicSW"),sw_Lyr.set("keyname","mosaicSW"),sw_Lyr.setVisible(visibleInit),(se_Lyr=SELayer).set("title","MosaicSE"),se_Lyr.set("keyname","mosaicSE"),se_Lyr.setVisible(visibleInit),nw_Lyr.on("precompose",function(event){var widthMouse,heightMouse,ctx=event.context,pixelRatio=event.frameState.pixelRatio;"undefined"==typeof mousePosition?(widthMouse=(pixelPos=objMap.getSize())[0],heightMouse=pixelPos[1]):mousePosition?(widthMouse=mousePosition[0]*pixelRatio,heightMouse=mousePosition[1]*pixelRatio):(widthMouse=(pixelPos=objMap.getSize())[0],heightMouse=pixelPos[1]),ctx.save(),ctx.beginPath(),0==fixedSizes?ctx.rect(0,0,widthMouse-2*pixelRatio,heightMouse-2*pixelRatio):ctx.rect(0,0,objMap.getSize()[0]*pixelRatio/2-2*pixelRatio,objMap.getSize()[1]*pixelRatio/2-2*pixelRatio),ctx.lineWidth=4*pixelRatio,ctx.strokeStyle="rgba(0, 102, 204, 0.9)",ctx.stroke(),ctx.clip()}),nw_Lyr.on("postcompose",function(event){event.context.restore()}),ne_Lyr.on("precompose",function(event){var widthMouse,heightMouse,ctx=event.context,pixelRatio=event.frameState.pixelRatio;"undefined"==typeof mousePosition?(widthMouse=(pixelPos=objMap.getSize())[0],heightMouse=pixelPos[1]):mousePosition?(widthMouse=mousePosition[0]*pixelRatio,heightMouse=mousePosition[1]*pixelRatio):(widthMouse=(pixelPos=objMap.getSize())[0],heightMouse=pixelPos[1]),ctx.save(),ctx.beginPath(),0==fixedSizes?ctx.rect(widthMouse,0,ctx.canvas.width-widthMouse,heightMouse):ctx.rect(objMap.getSize()[0]*pixelRatio/2,0,ctx.canvas.width-objMap.getSize()[0]*pixelRatio/2,objMap.getSize()[1]*pixelRatio/2),ctx.clip()}),ne_Lyr.on("postcompose",function(event){event.context.restore()}),sw_Lyr.on("precompose",function(event){var widthMouse,heightMouse,ctx=event.context,pixelRatio=event.frameState.pixelRatio;"undefined"==typeof mousePosition?(widthMouse=(pixelPos=objMap.getSize())[0],heightMouse=pixelPos[1]):mousePosition?(widthMouse=mousePosition[0]*pixelRatio,heightMouse=mousePosition[1]*pixelRatio):(widthMouse=(pixelPos=objMap.getSize())[0],heightMouse=pixelPos[1]),ctx.save(),ctx.beginPath(),0==fixedSizes?ctx.rect(0,heightMouse,widthMouse,ctx.canvas.height-heightMouse):ctx.rect(0,objMap.getSize()[1]*pixelRatio/2,objMap.getSize()[0]*pixelRatio/2,ctx.canvas.height-objMap.getSize()[1]*pixelRatio/2),ctx.clip()}),sw_Lyr.on("postcompose",function(event){event.context.restore()}),se_Lyr.on("precompose",function(event){var widthMouse,heightMouse,ctx=event.context,pixelRatio=event.frameState.pixelRatio;"undefined"==typeof mousePosition?(widthMouse=(pixelPos=objMap.getSize())[0],heightMouse=pixelPos[1]):mousePosition?(widthMouse=mousePosition[0]*pixelRatio,heightMouse=mousePosition[1]*pixelRatio):(widthMouse=(pixelPos=objMap.getSize())[0],heightMouse=pixelPos[1]),ctx.save(),ctx.beginPath(),0==fixedSizes?ctx.rect(widthMouse+2*pixelRatio,heightMouse+2*pixelRatio,ctx.canvas.width-widthMouse,ctx.canvas.height-heightMouse):ctx.rect(objMap.getSize()[0]*pixelRatio/2+2*pixelRatio,objMap.getSize()[1]*pixelRatio/2+2*pixelRatio,ctx.canvas.width-objMap.getSize()[0]*pixelRatio/2,ctx.canvas.height-objMap.getSize()[1]*pixelRatio/2),ctx.lineWidth=4*pixelRatio,ctx.strokeStyle="rgba(0, 102, 204, 0.9)",ctx.stroke(),ctx.clip()}),se_Lyr.on("postcompose",function(event){event.context.restore()}),vizLayerList.push(nw_Lyr),vizLayerList.push(ne_Lyr),vizLayerList.push(se_Lyr),vizLayerList.push(sw_Lyr)}function activateVerticalSwipeViz(WestLayer,EastLayer,visibleInit){(west_Lyr=WestLayer).set("title","SwipeW"),west_Lyr.set("keyname","swipeWest"),west_Lyr.setVisible(visibleInit),(east_Lyr=EastLayer).set("title","SwipeE"),east_Lyr.set("keyname","swipeEast"),east_Lyr.setVisible(visibleInit),west_Lyr.on("precompose",function(event){var widthMouse,heightMouse,ctx=event.context,pixelRatio=event.frameState.pixelRatio,lienzoMapa=objMap.getSize();if("undefined"==typeof mousePosition)widthMouse=lienzoMapa[0],heightMouse=lienzoMapa[1];else if(mousePosition){lienzoMapa[1];widthMouse=mousePosition[0]*pixelRatio,heightMouse=lienzoMapa[1]}else pixelPos=objMap.getSize(),widthMouse=lienzoMapa[0],heightMouse=lienzoMapa[1];ctx.save(),ctx.beginPath(),1==fixedSizes?ctx.rect(0,0,lienzoMapa[0]/2*pixelRatio-2*pixelRatio,heightMouse):ctx.rect(0,0,widthMouse-2*pixelRatio,heightMouse),ctx.lineWidth=4*pixelRatio,ctx.strokeStyle="rgba(0, 102, 204, 0.9)",ctx.stroke(),ctx.clip()}),west_Lyr.on("postcompose",function(event){event.context.restore()}),east_Lyr.on("precompose",function(event){var widthMouse,heightMouse,ctx=event.context,pixelRatio=event.frameState.pixelRatio,lienzoMapa=objMap.getSize();if("undefined"==typeof mousePosition)widthMouse=lienzoMapa[0],heightMouse=lienzoMapa[1];else if(mousePosition){lienzoMapa[1];widthMouse=mousePosition[0]*pixelRatio,heightMouse=lienzoMapa[1]}else widthMouse=lienzoMapa[0],heightMouse=lienzoMapa[1];ctx.save(),ctx.beginPath(),1==fixedSizes?ctx.rect(lienzoMapa[0]*pixelRatio/2,0,ctx.canvas.width-lienzoMapa[0]*pixelRatio/2,heightMouse):ctx.rect(widthMouse,0,ctx.canvas.width-widthMouse,heightMouse),ctx.clip()}),east_Lyr.on("postcompose",function(event){event.context.restore()}),vizLayerList.push(west_Lyr),vizLayerList.push(east_Lyr)}function activateHorizontalSwipeViz(NorthLayer,SouthLayer,visibleInit){(north_Lyr=NorthLayer).set("title","SwipeN"),north_Lyr.set("keyname","swipeNorth"),north_Lyr.setVisible(visibleInit),(south_Lyr=SouthLayer).set("title","SwipeS"),south_Lyr.set("keyname","swipeSouth"),south_Lyr.setVisible(visibleInit),north_Lyr.on("precompose",function(event){var widthMouse,heightMouse,ctx=event.context,pixelRatio=event.frameState.pixelRatio,lienzoMapa=objMap.getSize();if("undefined"==typeof mousePosition)widthMouse=lienzoMapa[0],heightMouse=lienzoMapa[1];else if(mousePosition){lienzoMapa[0];widthMouse=lienzoMapa[0],heightMouse=mousePosition[1]*pixelRatio}else widthMouse=lienzoMapa[0],heightMouse=lienzoMapa[1];ctx.save(),ctx.beginPath(),0==fixedSizes?ctx.rect(0,0,widthMouse,heightMouse-2*pixelRatio):ctx.rect(0,0,widthMouse,lienzoMapa[1]*pixelRatio/2-2*pixelRatio),ctx.lineWidth=4*pixelRatio,ctx.strokeStyle="rgba(0, 102, 204, 0.9)",ctx.stroke(),ctx.clip()}),north_Lyr.on("postcompose",function(event){event.context.restore()}),south_Lyr.on("precompose",function(event){var widthMouse,heightMouse,ctx=event.context,pixelRatio=event.frameState.pixelRatio,lienzoMapa=objMap.getSize();if("undefined"==typeof mousePosition)widthMouse=lienzoMapa[0],heightMouse=lienzoMapa[1];else if(mousePosition){lienzoMapa[0];widthMouse=lienzoMapa[0],heightMouse=mousePosition[1]*pixelRatio}else widthMouse=lienzoMapa[0],heightMouse=lienzoMapa[1];ctx.save(),ctx.beginPath(),0==fixedSizes?ctx.rect(0,heightMouse,widthMouse,ctx.canvas.height-heightMouse):ctx.rect(0,lienzoMapa[1]*pixelRatio/2,widthMouse,ctx.canvas.height-lienzoMapa[1]*pixelRatio/2),ctx.clip()}),south_Lyr.on("postcompose",function(event){event.context.restore()}),vizLayerList.push(north_Lyr),vizLayerList.push(south_Lyr)}function apagarTodo(){spot_Lyr.setVisible(0),west_Lyr.setVisible(0),east_Lyr.setVisible(0),north_Lyr.setVisible(0),south_Lyr.setVisible(0),nw_Lyr.setVisible(0),ne_Lyr.setVisible(0),sw_Lyr.setVisible(0),se_Lyr.setVisible(0),objMap.removeInteraction(drawVerticalSwipe),objMap.removeInteraction(drawHorizontalSwipe),hideSelectorPanel()}function changeToVerticalSwipeViz(WestLayer,EastLayer){west_Lyr.setSource(WestLayer.getSource()),west_Lyr.set("alias",WestLayer.getProperties().alias),west_Lyr.set("keyname",WestLayer.getProperties().keyname),east_Lyr.setSource(EastLayer.getSource()),east_Lyr.set("alias",EastLayer.getProperties().alias),east_Lyr.set("keyname",EastLayer.getProperties().keyname),$.when(apagarTodo()).done(function(){west_Lyr.setVisible(1),east_Lyr.setVisible(1),0==fixedSizes&&objMap.addInteraction(drawVerticalSwipe),$("#cobselectorText1").text(WestLayer.getProperties().alias),$("#cobselectorText2").text(EastLayer.getProperties().alias),listaCapas=west_Lyr.getProperties().keyname+","+east_Lyr.getProperties().keyname})}function changeLayerInVerticalSwipeViz(layerChange,posicion){"West"==posicion&&(west_Lyr.setSource(layerChange.getSource()),west_Lyr.set("alias",layerChange.getProperties().alias),west_Lyr.set("keyname",layerChange.getProperties().keyname),$("#cobselectorText1").text(layerChange.getProperties().alias)),"East"==posicion&&(east_Lyr.setSource(layerChange.getSource()),east_Lyr.set("alias",layerChange.getProperties().alias),east_Lyr.set("keyname",layerChange.getProperties().keyname),$("#cobselectorText2").text(layerChange.getProperties().alias)),$.when(apagarTodo()).done(function(){west_Lyr.setVisible(1),east_Lyr.setVisible(1),0==fixedSizes&&objMap.addInteraction(drawVerticalSwipe),listaCapas=west_Lyr.getProperties().keyname+","+east_Lyr.getProperties().keyname})}function changeToHorizontalSwipeViz(NorthLayer,SouthLayer){north_Lyr.setSource(NorthLayer.getSource()),north_Lyr.set("alias",NorthLayer.getProperties().alias),north_Lyr.set("keyname",NorthLayer.getProperties().keyname),south_Lyr.setSource(SouthLayer.getSource()),south_Lyr.set("alias",SouthLayer.getProperties().alias),south_Lyr.set("keyname",SouthLayer.getProperties().keyname),$("#cobselectorText1").text(NorthLayer.getProperties().alias),$("#cobselectorText2").text(SouthLayer.getProperties().alias),$.when(apagarTodo()).done(function(){north_Lyr.setVisible(1),south_Lyr.setVisible(1),0==fixedSizes&&objMap.addInteraction(drawHorizontalSwipe),listaCapas=north_Lyr.getProperties().keyname+","+south_Lyr.getProperties().keyname})}function changeLayerInHorizontalSwipeViz(layerChange,posicion){"North"==posicion&&(north_Lyr.setSource(layerChange.getSource()),north_Lyr.set("alias",layerChange.getProperties().alias),north_Lyr.set("keyname",layerChange.getProperties().keyname),$("#cobselectorText1").text(layerChange.getProperties().alias)),"South"==posicion&&(south_Lyr.setSource(layerChange.getSource()),south_Lyr.set("alias",layerChange.getProperties().alias),south_Lyr.set("keyname",layerChange.getProperties().keyname),$("#cobselectorText2").text(layerChange.getProperties().alias)),$.when(apagarTodo()).done(function(){north_Lyr.setVisible(1),south_Lyr.setVisible(1),0==fixedSizes&&objMap.addInteraction(drawHorizontalSwipe),listaCapas=north_Lyr.getProperties().keyname+","+south_Lyr.getProperties().keyname})}function changeToSpotViz(spotLayer){spot_Lyr.setSource(spotLayer.getSource()),spot_Lyr.set("alias",spotLayer.getProperties().alias),spot_Lyr.set("keyname",spotLayer.getProperties().keyname),$("#cobselectorText1").text(spotLayer.getProperties().alias),$.when(apagarTodo()).done(function(){spot_Lyr.setVisible(1),listaCapas=spotLayer.getProperties().keyname})}function changeToMosaicViz(NWLayer,NELayer,SWLayer,SELayer){nw_Lyr.setSource(NWLayer.getSource()),nw_Lyr.set("alias",NWLayer.getProperties().alias),nw_Lyr.set("keyname",NWLayer.getProperties().keyname),ne_Lyr.setSource(NELayer.getSource()),ne_Lyr.set("alias",NELayer.getProperties().alias),ne_Lyr.set("keyname",NELayer.getProperties().keyname),sw_Lyr.setSource(SWLayer.getSource()),sw_Lyr.set("alias",SWLayer.getProperties().alias),sw_Lyr.set("keyname",SWLayer.getProperties().keyname),se_Lyr.setSource(SELayer.getSource()),se_Lyr.set("alias",SELayer.getProperties().alias),se_Lyr.set("keyname",SELayer.getProperties().keyname),$("#cobselectorText1").text(NWLayer.getProperties().alias),$("#cobselectorText2").text(NELayer.getProperties().alias),$("#cobselectorText3").text(SWLayer.getProperties().alias),$("#cobselectorText4").text(SELayer.getProperties().alias),$.when(apagarTodo()).done(function(){nw_Lyr.setVisible(1),ne_Lyr.setVisible(1),sw_Lyr.setVisible(1),se_Lyr.setVisible(1),listaCapas=nw_Lyr.getProperties().keyname+","+ne_Lyr.getProperties().keyname+","+sw_Lyr.getProperties().keyname+","+se_Lyr.getProperties().keyname})}function changeLayerInMosaicViz(layerChange,posicion){"NW"==posicion?(nw_Lyr.setSource(layerChange.getSource()),nw_Lyr.set("alias",layerChange.getProperties().alias),nw_Lyr.set("keyname",layerChange.getProperties().keyname),$("#cobselectorText1").text(layerChange.getProperties().alias)):"NE"==posicion?(ne_Lyr.setSource(layerChange.getSource()),ne_Lyr.set("alias",layerChange.getProperties().alias),ne_Lyr.set("keyname",layerChange.getProperties().keyname),$("#cobselectorText2").text(layerChange.getProperties().alias)):"SW"==posicion?(sw_Lyr.setSource(layerChange.getSource()),sw_Lyr.set("alias",layerChange.getProperties().alias),sw_Lyr.set("keyname",layerChange.getProperties().keyname),$("#cobselectorText3").text(layerChange.getProperties().alias)):"SE"==posicion&&(se_Lyr.setSource(layerChange.getSource()),se_Lyr.set("alias",layerChange.getProperties().alias),se_Lyr.set("keyname",layerChange.getProperties().keyname),$("#cobselectorText4").text(layerChange.getProperties().alias)),$.when(apagarTodo()).done(function(){nw_Lyr.setVisible(1),ne_Lyr.setVisible(1),sw_Lyr.setVisible(1),se_Lyr.setVisible(1),listaCapas=nw_Lyr.getProperties().keyname+","+ne_Lyr.getProperties().keyname+","+sw_Lyr.getProperties().keyname+","+se_Lyr.getProperties().keyname})}function loadVizModes(){objMap.addLayer(spot_Lyr),objMap.addLayer(nw_Lyr),objMap.addLayer(ne_Lyr),objMap.addLayer(se_Lyr),objMap.addLayer(sw_Lyr),objMap.addLayer(west_Lyr),objMap.addLayer(east_Lyr),objMap.addLayer(north_Lyr),objMap.addLayer(south_Lyr)}document.addEventListener("keydown",function(evt){38===evt.which?(radius=Math.min(radius+5,200),map.render(),evt.preventDefault()):37===evt.which?(spotOpacity=Math.max(spotOpacity-4,30),spot_Lyr.setOpacity(spotOpacity/100),map.render(),evt.preventDefault()):39===evt.which?(spotOpacity=Math.min(spotOpacity+4,100),spot_Lyr.setOpacity(spotOpacity/100),map.render(),evt.preventDefault()):40===evt.which&&(radius=Math.max(radius-5,25),map.render(),evt.preventDefault())}),container.addEventListener("mousemove",function(event){mousePosition=objMap.getEventPixel(event),objMap.render()}),container.addEventListener("mouseout",function(){mousePosition=null,objMap.render()});